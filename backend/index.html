<!DOCTYPE html>
<html>
  <head>
    <title>Location Setup</title>
    <meta charset="UTF-8">
  </head>
  <body>
    <input id="name" placeholder="Your name">
    <label>
      <input id="is_mama_mboga" type="checkbox"> Are you Mama Mboga?
    </label>
    <button onclick="submitLocation()">Submit Location</button>
    <div id="status" style="margin-top: 10px; color: #333;"></div>
    <script>
      function submitLocation() {
        const name = document.getElementById("name").value.trim();
        const is_mama_mboga = document.getElementById("is_mama_mboga").checked;
        const statusDiv = document.getElementById("status");
        statusDiv.textContent = "";

        if (!name) {
          statusDiv.textContent = "Please enter a name.";
          return;
        }
        if (!navigator.geolocation) {
          statusDiv.textContent = "Geolocation not supported.";
          return;
        }

        statusDiv.textContent = "Getting locationâ€¦";
        navigator.geolocation.getCurrentPosition(
          function (pos) {
            // POST to backend
            fetch("http://localhost:8000/api/locations/", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                name,
                latitude: pos.coords.latitude,
                longitude: pos.coords.longitude,
                is_mama_mboga
              }),
            })
              .then(async (res) => {
                if (!res.ok) {
                  // Backend error (e.g., validation)
                  const err = await res.json();
                  statusDiv.textContent = "Error: " + JSON.stringify(err);
                  return;
                }
                statusDiv.textContent = "Location saved!";
                document.getElementById("name").value = "";
                document.getElementById("is_mama_mboga").checked = false;
              })
              .catch((err) => {
                statusDiv.textContent = "Network error: " + err.message;
              });
          },
          function (err) {
            statusDiv.textContent = "Error getting location: " + err.message;
          }
        );
      }
    </script>
  </body>
</html>